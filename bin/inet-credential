#!/usr/bin/env bash

# mind the password getting without sed

# https://github.com/mogensen/keychain
_GET_PASS=0
_GET_USER=0
_ME=$(basename "${0}")
_V="v1.0.0"

_print_help() {
    cat <<HEREDOC

   ___________ @ @
  /  INET   (@\\   @             ${_ME}
  \\___________/  _@             ${_V}
            @  _/@ \\_____		
             @/ \\__/-="="\`      Find internet usernames and passwords
              \\_ /              from OSX keychain by service name.
               <|				
               <|               Usage:
      mrh      <|                 ${_ME} [<arguments>]
               \`                  ${_ME} -h | --help

HEREDOC
}

while [ "$1" != "" ]
do
	case $1
		in
		-p) _GET_PASS=1;
			shift 1;;
		-u) _GET_USER=1;
			shift 1;;
		-s) __service=$2;
			shift 2;;
		-h|--help) 
			_print_help
			exit 0;;
		*)  echo "Option [$1] not one of [p, u, s]";    # Error (!)
			_print_help
			exit 1;;
	esac
done

# Get username (account)
if test $_GET_USER -gt 0 ; then
	# -s  Match "server" string
	/usr/bin/security find-internet-password -s "$__service" | grep "acct" | cut -d \" -f 4
	exit 0
fi

# Get password
if test $_GET_PASS -gt 0 ; then
	# -w  Display only the password on stdout
	/usr/bin/security find-internet-password -ws "$__service"
	exit 0
fi
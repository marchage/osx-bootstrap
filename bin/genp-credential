#!/usr/bin/env bash

# https://github.com/mogensen/keychain
_GET_PASS=0
_GET_USER=0
_ME=$(basename "${0}")
_V="v1.0.0"

_print_help() {
    cat <<HEREDOC

   ___________ @ @
  / Generic (@\\   @             ${_ME}
  \\___________/  _@             ${_V}
            @  _/@ \\_____		
             @/ \\__/-="="\`      Find generic usernames and passwords
              \\_ /              from OSX keychain by service name.
               <|				
               <|               Usage:
      mrh      <|                 ${_ME} [<arguments>]
               \`                  ${_ME} -h | --help

HEREDOC
}

while [ "$1" != "" ]
do
	case $1
		in
		-p) _GET_PASS=1;
			shift 1;;
		-u) _GET_USER=1;
			shift 1;;
		-s) __service=$2;
			shift 2;;
		-v) verbose=1;
			shift 1;;
		-h|--help) 
			_print_help
			exit 0;;
		*)  echo "Option [$1] not one of  [p, u, s, v]";    # Error (!)
			_print_help
			exit 1;;
	esac
done

__sec=$(/usr/bin/security find-generic-password -s "$__service" -g 2>&1)
#__sec=`/usr/bin/security find-internet-password -s "$__service" -g 2>&1`

_getAttribute() {
	echo "$__sec" | grep "$1" | cut -d \" -f 4
}

# Get username (account)
if test $_GET_USER -gt 0 ; then
	_getAttribute "acct"
	exit 0
fi

# Get password
if test $_GET_PASS -gt 0 ; then
	echo "$__sec" | grep "password" | sed 's/^password: "\(.*\)"$/\1/'
	exit 0
fi